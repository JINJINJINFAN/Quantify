<!-- äº¤æ˜“æ¨¡å¼çŠ¶æ€å¡ç‰‡ç»„ä»¶ -->
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="card-title">
                    <i class="fas fa-toggle-on me-2"></i>è¿è¡Œæ¨¡å¼
                </h5>
                <p class="card-text text-muted">å½“å‰äº¤æ˜“æ¨¡å¼çŠ¶æ€</p>
            </div>
            <div class="text-end">
                <div class="h4 mb-0">
                    <span id="trading_mode_icon_main">{{ trading_mode.mode_icon if trading_mode else 'ğŸŸ¡' }}</span>
                    <span id="trading_mode_text_main">{{ trading_mode.trading_mode if trading_mode else 'æ¨¡æ‹Ÿäº¤æ˜“' }}</span>
                </div>
                <small class="text-muted" id="trading_mode_warning_main">
                    {{ trading_mode.warning_message if trading_mode else 'ğŸŸ¡ æ¨¡æ‹Ÿäº¤æ˜“æ¨¡å¼ï¼Œä¸ä¼šä½¿ç”¨çœŸå®èµ„é‡‘' }}
                </small>
            </div>
        </div>
        <div class="mt-3">
            <div class="btn-group btn-group-sm w-100" role="group">
                <button type="button" class="btn btn-outline-danger {{ 'active' if trading_mode and trading_mode.real_trading else '' }}" 
                        id="real_mode_btn_main" onclick="switchTradingMode('real')"
                        {{ 'disabled' if trading_mode and not trading_mode.can_switch_to_real else '' }}>
                    <i class="fas fa-exclamation-triangle me-1"></i>çœŸå®äº¤æ˜“
                </button>
                <button type="button" class="btn btn-outline-warning {{ 'active' if trading_mode and not trading_mode.real_trading else '' }}" 
                        id="simulation_mode_btn_main" onclick="switchTradingMode('simulation')">
                    <i class="fas fa-shield-alt me-1"></i>æ¨¡æ‹Ÿäº¤æ˜“
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// æ›´æ–°äº¤æ˜“æ¨¡å¼æ˜¾ç¤ºï¼ˆä¸»é¡µç‰ˆæœ¬ï¼‰
function updateTradingModeDisplayMain(modeData) {
    const modeIcon = document.getElementById('trading_mode_icon_main');
    const modeText = document.getElementById('trading_mode_text_main');
    const modeWarning = document.getElementById('trading_mode_warning_main');
    const realModeBtn = document.getElementById('real_mode_btn_main');
    const simulationModeBtn = document.getElementById('simulation_mode_btn_main');
    
    if (modeIcon) modeIcon.textContent = modeData.mode_icon || 'ğŸŸ¡';
    if (modeText) modeText.textContent = modeData.trading_mode || 'æ¨¡æ‹Ÿäº¤æ˜“';
    if (modeWarning) modeWarning.textContent = modeData.warning_message || '';
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    if (realModeBtn) {
        realModeBtn.disabled = !modeData.can_switch_to_real;
        realModeBtn.classList.toggle('active', modeData.real_trading);
    }
    if (simulationModeBtn) {
        simulationModeBtn.classList.toggle('active', !modeData.real_trading);
    }
}

// é¡µé¢åŠ è½½æ—¶è·å–äº¤æ˜“æ¨¡å¼ï¼ˆå¦‚æœæ²¡æœ‰æœåŠ¡å™¨ç«¯æ•°æ®ï¼‰
document.addEventListener('DOMContentLoaded', function() {
    {% if not trading_mode %}
    loadTradingMode();
    {% endif %}
});

function loadTradingMode() {
    fetch('/api/trading_mode')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateTradingModeDisplayMain(data.mode);
            }
        })
        .catch(error => {
            console.error('è·å–äº¤æ˜“æ¨¡å¼å¤±è´¥:', error);
        });
}

// åˆ‡æ¢äº¤æ˜“æ¨¡å¼
function switchTradingMode(mode) {
    const modeText = mode === 'real' ? 'çœŸå®äº¤æ˜“' : 'æ¨¡æ‹Ÿäº¤æ˜“';
    
    if (confirm(`ç¡®å®šè¦åˆ‡æ¢åˆ°${modeText}æ¨¡å¼å—ï¼Ÿ`)) {
        fetch('/api/trading_mode', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ mode: mode })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                utils.showMessage(`å·²åˆ‡æ¢åˆ°${modeText}æ¨¡å¼`, 'success');
                // é‡æ–°åŠ è½½äº¤æ˜“æ¨¡å¼æ•°æ®
                loadTradingMode();
                // åˆ·æ–°é¡µé¢ä»¥æ›´æ–°æ‰€æœ‰ç›¸å…³æ•°æ®
                setTimeout(() => location.reload(), 1000);
            } else {
                utils.showMessage(`åˆ‡æ¢å¤±è´¥: ${data.message}`, 'danger');
            }
        })
        .catch(error => {
            console.error('åˆ‡æ¢äº¤æ˜“æ¨¡å¼å¤±è´¥:', error);
            utils.showMessage('åˆ‡æ¢äº¤æ˜“æ¨¡å¼å¼‚å¸¸: ' + error.message, 'danger');
        });
    }
}
</script> 